:_mod-docs-content-type: ASSEMBLY
[id="cert-types-node-certificates"]
= Node certificates
include::_attributes/common-attributes.adoc[]
:context: cert-types-node-certificates

toc::[]

== Purpose

Node certificates are signed by the cluster; they come from a certificate authority (CA) that is generated by the bootstrap process. After the cluster is installed, the node certificates are auto-rotated.

// 1. the kube-api-server to kubelet one. Signer is the CA. it signs the client-ca (kube api server to). Purpose is for the API server to contact the kubelet directly
// 2. kubelet serving certificat4e. Kubelet to communicate w/ the api server in normal operations. (the #1 one was for API-> kubelet; this one is kubelet -> API). This is signed by a CA - but need ryan to spin up a cluster to get th details. For kubelet to contact API server for pods/requests, etc. kubelet auto rotates this
// 3. bootstrap certificate. /etc/kubernetes/kubeconfig <- this is managed by the installer. It contains the bootstrap certificate (10yrs in future) kubelet reads it to get the serving cert (used for purpose #2).

{product-title} has the following node certificates:

// TODO: the boostrap cert is already covered in the Boostrap certificates section.
// * The bootstrap certificate located at `/etc/kubernetes/kubeconfig`. This is managed by the installation program and contains the bootstrap certificate, which expires 10 years in the future. The kubelet reads it to get the kubelet serving certificate.

Kubelet ??? :: This allows the Kubernetes API server to communicate with the kubelet.

kube-apiserver-to-kubelet-signer

Kubelet serving certificate:: This allows the kubelet to communicate with the Kubernetes API server. This certificate is created from the bootstrap process and is automatically rotated by the kubelet.




== Location

// `/etc/kubernetes/kubelet-ca.crt` certificate authority (CA) ?
//
// kube-apiserver-to-kubelet-client-ca config map in the openshift-kube-apiserver-operator namespace?
//
// // from KCS on how to initiate renewal
// kube-apiserver-to-kubelet-signer secret in the openshift-kube-apiserver-operator namespace?

// Example location from another file:
// The user-provided certificates must be provided in a `kubernetes.io/tls` type `Secret` in the `openshift-config` namespace. Update the API server cluster configuration, the `apiserver/cluster` resource, to enable the use of the user-provided certificate.


== Management

These certificates are managed by the system and not the user.

== Expiration

Kubelet CA certificates expire after 365 days.

// TODO: Might be different depending on which one we're talking about

== Renewal

// TODO: Auth team to confirm this section; also is this just one type?
The Kubernetes API Server Operator automatically generates a new `kube-apiserver-to-kubelet-signer` CA certificate at 292 days. The old CA certificate is removed after 365 days. Nodes are not rebooted when a kubelet CA certificate is renewed or removed.

Cluster administrators can manually renew the kubelet CA certificate by running the following command:

[source,terminal]
----
$ oc annotate -n openshift-kube-apiserver-operator secret kube-apiserver-to-kubelet-signer auth.openshift.io/certificate-not-after-
----

[discrete]
[role="_additional-resources"]
== Additional resources

* xref:../../nodes/nodes/nodes-nodes-working.adoc#nodes-nodes-working[Working with nodes]
